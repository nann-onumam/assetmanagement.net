<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<!-- Asset Form Dialog -->
<app-asset-form
  [(visible)]="formVisible"
  [editingAsset]="editingAsset"
  (assetSaved)="onAssetSaved($event)">
</app-asset-form>

<div class="surface-section px-4 py-4">
  <!-- Toolbar Header -->
  <p-toolbar class="mb-4">
    <ng-template pTemplate="left">
      <h1 class="m-0 text-3xl font-bold">Asset Management</h1>
    </ng-template>
    <ng-template pTemplate="right">
      <p-button 
        label="Add New Asset" 
        icon="pi pi-plus" 
        (click)="openNewAssetForm()"
        [rounded]="true"
        severity="success">
      </p-button>
    </ng-template>
  </p-toolbar>

  <!-- Data Table -->
  <p-table
    #dt
    [value]="assets"
    [loading]="loading"
    [globalFilterFields]="['name', 'model', 'category.name']"
    responsiveLayout="scroll"
    styleClass="p-datatable-striped p-datatable-hoverable-rows"
    [tableStyle]="{ 'min-width': '50rem' }">

    <!-- Column Headers -->
    <ng-template #header>
      <tr>
        <th style="width: 5%">ID</th>
        <th style="width: 15%">Name</th>
        <th style="width: 12%">Model</th>
        <th style="width: 20%">Description</th>
        <th style="width: 12%">Category</th>
        <th style="width: 10%">Value</th>
        <th style="width: 10%">Status</th>
        <th style="width: 16%">Actions</th>
      </tr>
    </ng-template>

    <!-- Table Body -->
    <ng-template #body let-asset>
      <tr>
        <td>
          <span class="font-semibold">{{ asset.id }}</span>
        </td>
        <td>
          <span class="font-semibold text-surface-900">{{ asset.name }}</span>
        </td>
        <td>
          {{ asset.model }}
        </td>
        <td>
          <span class="text-sm text-surface-600">{{ asset.description || '-' }}</span>
        </td>
        <td>
          <span class="inline-flex align-items-center gap-2 px-3 py-1 bg-surface-100 border-round">
            {{ asset.category?.name || 'Unassigned' }}
          </span>
        </td>
        <td>
          <span class="font-semibold text-green-600">
            {{ asset.value | currency:'USD':'symbol':'1.2-2' }}
          </span>
        </td>
        <td>
          <p-tag
            [value]="asset.status || 'Unknown'"
            [severity]="getStatusSeverity(asset.status)"
            [rounded]="true">
          </p-tag>
        </td>
        <td>
          <p-splitButton
            label="Actions"
            icon="pi pi-cog"
            [model]="getActionItems(asset)"
            (onClick)="viewAsset(asset)"
            [rounded]="true"
            severity="secondary">
          </p-splitButton>
        </td>
      </tr>
    </ng-template>

    <!-- Empty Message -->
    <ng-template #emptymessage>
      <tr>
        <td colspan="8" class="text-center py-8">
          <div class="flex flex-column align-items-center justify-center gap-3 min-h-20rem">
            <i class="pi pi-inbox text-6xl text-surface-300"></i>
            <div class="text-center">
              <p class="text-xl font-semibold text-surface-600 mb-2">No assets found</p>
              <p class="text-sm text-surface-500">Get started by adding your first asset</p>
            </div>
          </div>
        </td>
      </tr>
    </ng-template>

    <!-- Loading Indicator -->
    <ng-template #loadingbody>
      <tr>
        <td colspan="8" class="text-center py-4">
          <p-progressSpinner [strokeWidth]="'4'" [style]="{ 'width': '50px', 'height': '50px' }"></p-progressSpinner>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <!-- Custom Paginator -->
  <div class="flex items-center justify-end mt-3">
    <span class="mx-1 text-color">Items per page: </span>
    <p-select [options]="options" optionLabel="label" optionValue="value" [(ngModel)]="rows2" (ngModelChange)="first2 = 0" />
    <p-paginator
        [first]="first2"
        [rows]="rows2"
        [totalRecords]="assets.length"
        (onPageChange)="onPageChange2($event)"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="{first} - {last} of {totalRecords}"
        [showPageLinks]="false"
        [showFirstLastIcon]="false">
    </p-paginator>
  </div>
</div>
